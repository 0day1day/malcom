{% extends "base.html" %}
{% block main %}

<div class='span9 graph'>
</div>

<script type="text/javascript">

var radiusScale = 
      d3.scale.log()
  .domain([1, 20])
  .range([1, 15]);

var color = d3.scale.category10();

var width = $('.graph').width(),
    height = $('.graph').height();

$('div.data').height(height);
$('div.data').width($(window).width()-width-20);

var nodes = [],
    links = [],
    shiftKey;

var force = d3.layout.force()
    .nodes(nodes)
    .links(links)
    .charge(-400)
    .friction(.6)
    .linkDistance(120)
    .size([width, height])
    .on("tick", tick);

var svg = d3.select(".graph").append("svg")
    .attr("width", width)
    .attr("height", height);

  d3.select('body')
    .attr("tabindex", 1)
    .on("keydown.brush", keydown)
    .on("keyup.brush", keyup)
    .each(function() { this.focus(); });

var brush = svg.append("g")
    .datum(function() { return {selected: false, previouslySelected: false}; })
    .attr("class", "brush");

    brush.call(d3.svg.brush()
        .x(d3.scale.identity().domain([0, width]))
        .y(d3.scale.identity().domain([0, height]))
        .on("brushstart", function(d) {
          node.each(function(d) { 
            d.previouslySelected = shiftKey && d.selected; 
          });
        })
        .on("brush", function() {
          var extent = d3.event.target.extent();
          node.classed("selected", function(d) {
            d.selected = d.previouslySelected ^
                (extent[0][0] <= d.x && d.x < extent[1][0]
                && extent[0][1] <= d.y && d.y < extent[1][1]);
                return d.selected;
          });
        })
        .on("brushend", function() {
          d3.event.target.clear();
          d3.select(this).call(d3.event.target);
        }));



var node = svg.selectAll(".node"),
    link = svg.selectAll(".link");

d3.json("/graph/{{field}}/{{value}}", function(error, graph) {
  
   for (var i in graph.nodes) {
     nodes.push(graph.nodes[i])
   } 

   for (var i in graph.edges) {
    links.push(graph.edges[i])
   }



for (var i=0; i < nodes.length; i++) {
                nodes[i].x = Math.random()*width;
                nodes[i].y = Math.random()*height;
            }


  start();
});



</script>
{%endblock%}
{% block sidebar %}
<div class='data span3 toolbar'>
  <h1>Highlight</h1>

  <div class="input-append">
      <input class="span2" id="query" type="text">
      
      <button class='btn btn-primary' type='button' onclick="javascript:highlight($('#query').val())">Go</button>
      <button class='btn' type='button' onclick="javascript:highlight('clear'); $('#query').val('');">Clear</button>
  </div>

              

  <h1>Info</h1>
  <table class='table' id='node_info'></table>
  <div class='whois'></div>
</div>
{% endblock %}